# Generic Javascript Dropper

I came across a malicious javascript dropper quite a while ago and I wanted to see what it did. So as anybody would do I downloaded the file and cracked it open.

Unsurprisingly I was greeted by almost 7k lines of obfuscated javascript. Just taking a quick look it was easy to find a pattern in the obfuscation. There were 3 patterns in the code were: functions never called, for loops that were never entered, or while loops that were never entered.

```javascript
function Z$Z1(FtYGO6,GG73c,iKMHB,nyoN) {}

for (var KitM = 804650; KitM < 25109; $i += 80219) {}

var t0A = 4330; 
while (t0A < 719) {}
```

After removing all of those distractions I was left with around 400 variables and a single for loop.

```javascript
for (var IC = 0; IC < mnqR; IC += gFH) { 
  var bbO2EL = J4O$60(fnm, IC); 
  var oJMN = IC % qhgjc; 
  var e9G9o = J4O$60(fd5xK, oJMN); 
  var Bj6 = bbO2EL ^ e9G9o; 
  VkGo += B1K8(Bj6); 
} 
var ln0E = IctC(VkGo); 
ln0E(); 
```

I assumed that this loop was assembling the code for the dropper which would then be executed on that last line. I set a break point after the loop and then ran it. My hypothesis was correct and there was clear text javascript stored in VkGo at the end of the loop. Looking at that JS it was reaching out to compromised personal websites and trying to download a windows powershell script. Unfortunately when I tried to download that powershell I was unable to. Just for fun I went back and looked at that loop to determine what it was doing.

```javascript
var Encrypted = "21a32...44033";
var Key = "29337...f7c36"; 
var EncryptedLength = Encrypted.length; 
var KeyLength = Key.length; 
var JavaScript = ""; 
for (var i = 0; i < EncryptedLength; i += 2) { 
  var EncryptInt = parseInt(Encrypted.substr(i, 2), 16);
  var Offset = i % KeyLength; 
  var KeyInt = parseInt(Key.substr(Offset, 2), 16);
  var CharCode = EncryptInt ^ KeyInt; 
  JavaScript += String.fromCharCode(CharCode);
} 
JavaScript();
```